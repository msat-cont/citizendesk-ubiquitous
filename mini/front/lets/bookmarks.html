<html>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<head>
<!--script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" /></script-->
<script type="text/javascript" src="jquery.min.js" /></script>
<script type="text/javascript" language="JavaScript">
window.update_link = function(silent) {
    $('#book').hide();
    $('#book_warn').hide();

    function endsWith(str, suffix) {
        return str.indexOf(suffix, str.length - suffix.length) !== -1;
    };

    var cur_name = $('#user_name').val();
    var cur_feed = $('#feed_name').val();
    var to_warn = false;
    var cur_warn = 'false';
    if ($('#warn_leave').attr('checked')) {
        to_warn = true;
        cur_warn = 'true';
    }

    var cur_data_url = $('#data_url').val();
    var cur_data_url_ssl = $('#data_url_ssl').val();
    var cur_js_url = $('#js_url').val();
    var cur_js_url_ssl = $('#js_url_ssl').val();
    var cur_jquery_url = $('#jquery_url').val();
    var cur_jquery_url_ssl = $('#jquery_url_ssl').val();
    var cur_json2_url = $('#json2_url').val();
    var cur_json2_url_ssl = $('#json2_url_ssl').val();

    var in_vals = [cur_name, cur_feed, cur_data_url, cur_data_url_ssl, cur_js_url, cur_js_url_ssl, cur_jquery_url, cur_jquery_url_ssl, cur_json2_url, cur_json2_url_ssl];
    var in_vals_count = in_vals.length;
    for (var ind=0; ind<in_vals_count; ind++) {
        var cur_val = in_vals[ind];

        if (0 == cur_val.length) {
            return;
        }
        var forbidden = ['\\', '\'', '"', '>', '<'];
        var forbidden_count = forbidden.length;
        for (var ind_fb = 0; ind_fb<forbidden_count; ind_fb++) {
            var cur_fb = forbidden[ind_fb];
            if (cur_val.indexOf(cur_fb) > -1) {
                if (!silent) {
                    alert('do not use: < > " \' \\');
                }
                return;
            }
        }
    }

    if (!endsWith(cur_js_url, '/')) {
        cur_js_url += '/';
    }
    if (!endsWith(cur_js_url_ssl, '/')) {
        cur_js_url_ssl += '/';
    }

    var bml_link = "javascript:(function(){if((!window._ubi_cd)||(!window._ubi_cd['is_initialized'])){window._ubi_cd={};window._ubi_cd['feed_name']='" + cur_feed + "';window._ubi_cd['user_name']='";
    bml_link += cur_name + "';";
    bml_link += "window._ubi_cd['warn_leave']=" + cur_warn + ";";
    bml_link += "window._ubi_cd['feed_url']='" + cur_data_url + "';if('https:'==document.location.protocol){window._ubi_cd['feed_url']='" + cur_data_url_ssl + "'};";
    bml_link += "window._ubi_cd['jquery_url']='" + cur_jquery_url + "';if('https:'==document.location.protocol){window._ubi_cd['jquery_url']='" + cur_jquery_url_ssl + "'};";
    bml_link += "window._ubi_cd['json2_url']='" + cur_json2_url + "';if('https:'==document.location.protocol){window._ubi_cd['json2_url']='" + cur_json2_url_ssl + "'};";
    bml_link += "document.body.appendChild(document.createElement('script')).src=(";
    bml_link += "('https:'==document.location.protocol)?'" + cur_js_url_ssl + "':'" + cur_js_url + "'";
    bml_link += ")+'mini_cd.js';}else{";
    bml_link += "window._ubi_cd['show_switch'](";
    bml_link += "{'user_name':'"+cur_name+"','feed_url':(";
    bml_link += "('https:'==document.location.protocol)?'" + cur_data_url_ssl + "':'" + cur_data_url + "'";
    bml_link += "),'feed_name':'"+cur_feed+"','warn_leave':"+cur_warn+"});}})();";

    if (to_warn) {
        $('#book_warn').html('Snippets (warn/leave): ' + cur_feed);
        $('#book_warn').attr('href', bml_link);
        $('#book_warn').show();
    }
    else {
        $('#book').html('Snippets: ' + cur_feed);
        $('#book').attr('href', bml_link);
        $('#book').show();
    }
};
</script>
</head>
<body onLoad="window.update_link();">
Fill in your user name:
<br />
<input id="user_name" title="user name" type="text" size="25" onChange="window.update_link(false);" onKeyup="window.update_link(true);"></input>
<br />
<input id="warn_leave" name="warn_leave" title="warn on page leaving" type="checkbox" onChange="window.update_link(false);" onKeyup="window.update_link(true);" checked="yes"></input><label for="warn_leave">warn on page leaving</label>
<br />
<br />
<a id="book" rel="bookmarklet" style="display:none;" href="#" onClick="alert('save the link as bookmarklet'); return false;">Snippets</a>
<a id="book_warn" rel="bookmarklet" style="display:none;" href="#" onClick="alert('save the link as bookmarklet'); return false;">Snippets (warn/leave)</a>
<br />
<br />
<br />
<input id="feed_name" title="feed name" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="simple"></input>
<br />
<input id="data_url" title="data url" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="http://localhost/cd/data/bml_feeds/"></input>
<br />
<input id="data_url_ssl" title="data url / ssl" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="https://localhost/cd/data/bml_feeds/"></input>
<br />
<input id="js_url" title="JS url" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="http://localhost/cd/static/lets/"></input>
<br />
<input id="js_url_ssl" title="JS url / ssl" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="https://localhost/cd/static/lets/"></input>
<br />
<input id="jquery_url" title="jQuery url" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="http://localhost/cd/static/lets/jquery.min.js"></input>
<br />
<input id="jquery_url_ssl" title="jQuery url / ssl" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="https://localhost/cd/static/lets/jquery.min.js"></input>
<br />
<input id="json2_url" title="json2 url" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="http://localhost/cd/static/lets/json2.min.js"></input>
<br />
<input id="json2_url_ssl" title="json2 url / ssl" type="text" size="40" onChange="window.update_link(false);" onKeyup="window.update_link(true);" value="https://localhost/cd/static/lets/json2.min.js"></input>
</body>
</html>
